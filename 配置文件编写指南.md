# WindowInspector 配置文件编写指南

## 概述

本文档说明如何编写 WindowInspector 的分组配置文件，用于自动化图像识别和操作流程。

## 配置文件结构

配置文件为 JSON 格式，文件名为 `group_config.json`，包含一个分组对象。

### 基本结构

```json
{
  "Name": "分组名称",
  "Moles": [
    {
      // 步骤1配置
    },
    {
      // 步骤2配置
    }
  ]
}
```

## 分组对象 (MoleGroup)

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Name | string | 是 | 分组名称，用于标识和跳转 |
| Moles | array | 是 | 步骤列表，按顺序执行 |

## 步骤对象 (MoleItem)

**重要提示**：每个步骤对象必须包含所有字段，即使不使用某个字段，也必须设置其默认值。这是确保配置文件完整性和程序正确解析的关键要求。

每个步骤包含以下字段：

### 基础字段

| 字段名 | 类型 | 默认值 | 必填 | 说明 |
|--------|------|--------|------|------|
| Name | string | "" | 是 | 步骤名称，用于显示和日志 |
| ImagePath | string | "" | 否 | 图片文件路径（相对于配置文件的路径） |
| IsEnabled | boolean | true | 否 | 是否启用此步骤 |
| CreatedTime | string | 当前时间 | 否 | 创建时间（ISO 8601格式，如 "2025-01-27T00:00:00+08:00"） |
| SimilarityThreshold | number | 0.85 | 否 | 图片匹配相似度阈值（0-1），越高越严格 |

### 步骤类型标识

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| IsIdleClick | boolean | false | 是否为空击步骤（点击固定坐标） |
| IsJump | boolean | false | 是否为跳转步骤 |
| IsConfigStep | boolean | false | 是否为配置切换步骤 |

### 等待与点击行为

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| WaitUntilAppear | boolean | false | 等待图片出现后再执行 |
| ClickUntilDisappear | boolean | false | 持续点击直到图片消失 |
| WaitAfterClick | boolean | false | 点击后是否等待 |
| WaitAfterClickMs | number | 1000 | 点击后等待的毫秒数 |


### 失败处理

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| JumpToPreviousOnFail | boolean | false | 识别失败时跳转到上一个步骤 |
| StopHunting | boolean | false | 执行到此步骤时停止整个流程 |

### 空击步骤专用字段

当 `IsIdleClick = true` 时使用：

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| IdleClickPosition | string | null | 空击坐标，格式："x, y" 如 "1051, 486" |

### 跳转步骤专用字段

当 `IsJump = true` 时使用：

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| JumpTargetGroup | string | "" | 跳转目标分组名称 |
| JumpTargetStep | number | -1 | 跳转目标步骤索引（-1表示从头开始，0表示第1步） |

### 按键操作字段

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| SendKeyPress | boolean | false | 是否发送键盘按键 |
| KeyPressDefinition | string | "" | 按键定义，如 "F2", "Enter", "Ctrl+C" |
| KeyPressWaitMs | number | 100 | 按键后等待的毫秒数 |

### 鼠标滚动字段

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| EnableMouseScroll | boolean | false | 是否启用鼠标滚动 |
| ScrollUp | boolean | true | true=向上滚动，false=向下滚动 |
| ScrollCount | number | 1 | 滚动次数 |
| ScrollWaitMs | number | 100 | 滚动后等待的毫秒数 |

### 配置切换字段

当 `IsConfigStep = true` 时使用：

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| SwitchConfig | boolean | false | 是否切换配置 |
| TargetConfigName | string | "" | 目标配置名称 |
| ConfigSwitchWaitMs | number | 100 | 配置切换后等待的毫秒数 |
| SwitchTextContent | boolean | false | 是否切换填充内容 |
| TargetTextName | string | "" | 目标文本名称 |
| TextSwitchWaitMs | number | 100 | 内容切换后等待的毫秒数 |


## 步骤类型详解

### 1. 图片识别点击步骤（默认类型）

**用途**：识别屏幕上的图片并点击

**必需字段**：
- `Name`: 步骤名称
- `ImagePath`: 图片文件路径（相对路径，如 "images/button.png"）

**常用配置**：
```json
{
  "Name": "点击登录按钮",
  "ImagePath": "images/login_button.png",
  "IsEnabled": true,
  "SimilarityThreshold": 0.85,
  "WaitUntilAppear": true,
  "WaitAfterClick": true,
  "WaitAfterClickMs": 1000,
  "IsIdleClick": false,
  "IsJump": false,
  "IsConfigStep": false
}
```

**参数说明**：
- `SimilarityThreshold`: 0.6-0.7 宽松匹配，0.85 标准匹配，0.9+ 严格匹配
- `WaitUntilAppear`: 建议设为 true，等待元素出现
- `ClickUntilDisappear`: 用于关闭弹窗等需要反复点击的场景

### 2. 空击步骤

**用途**：点击屏幕上的固定坐标位置

**必需字段**：
- `Name`: 步骤名称
- `IsIdleClick`: 必须为 true
- `IdleClickPosition`: 坐标字符串

**配置示例**：
```json
{
  "Name": "空击位置1",
  "ImagePath": "",
  "IsEnabled": true,
  "IsIdleClick": true,
  "IdleClickPosition": "1051, 486",
  "SimilarityThreshold": 0.85,
  "IsJump": false,
  "IsConfigStep": false
}
```

### 3. 跳转步骤

**用途**：跳转到其他分组或步骤

**必需字段**：
- `Name`: 步骤名称
- `IsJump`: 必须为 true
- `JumpTargetGroup`: 目标分组名称

**配置示例**：
```json
{
  "Name": "跳转到默认分组",
  "ImagePath": "",
  "IsEnabled": true,
  "IsJump": true,
  "JumpTargetGroup": "默认",
  "JumpTargetStep": -1,
  "IsIdleClick": false,
  "IsConfigStep": false
}
```

**JumpTargetStep 说明**：
- `-1`: 从目标分组的第一步开始执行
- `0`: 从目标分组的第1步开始执行
- `5`: 从目标分组的第6步开始执行


### 4. 按键步骤

**用途**：模拟键盘按键操作

**必需字段**：
- `Name`: 步骤名称
- `SendKeyPress`: 必须为 true
- `KeyPressDefinition`: 按键定义

**配置示例**：
```json
{
  "Name": "按F2键",
  "ImagePath": "",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": false,
  "IdleClickPosition": null,
  "SimilarityThreshold": 0.85,
  "IsJump": true,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": false,
  "WaitAfterClickMs": 1000,
  "SendKeyPress": true,
  "KeyPressDefinition": "F2",
  "KeyPressWaitMs": 2000,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100
}
```

**支持的按键格式**：
- 单个按键：`"F1"`, `"F2"`, `"Enter"`, `"Esc"`, `"Tab"`
- 组合键：`"Ctrl+C"`, `"Ctrl+V"`, `"Alt+F4"`, `"Shift+Tab"`

**重要说明**：
- **按键步骤通常需要设置 `IsJump=true`**：即使不进行实际跳转，也建议设置 `IsJump=true`，这是程序处理按键操作的标准方式。此时 `JumpTargetGroup` 和 `JumpTargetStep` 可以留空（`""` 和 `-1`）。
- **按键等待时间**：`KeyPressWaitMs` 建议设置为 1000-3000ms，给程序足够时间处理按键操作。
- **图片路径**：按键步骤通常不需要图片，`ImagePath` 设置为空字符串 `""`。

### 5. 滚动步骤

**用途**：模拟鼠标滚轮滚动

**必需字段**：
- `EnableMouseScroll`: 必须为 true
- `ScrollUp`: 滚动方向
- `ScrollCount`: 滚动次数

**配置示例**：
```json
{
  "Name": "向下滚动",
  "ImagePath": "",
  "IsEnabled": true,
  "EnableMouseScroll": true,
  "ScrollUp": false,
  "ScrollCount": 3,
  "ScrollWaitMs": 500,
  "IsJump": true,
  "IsIdleClick": false,
  "IsConfigStep": false
}
```

**注意**：滚动操作通常与按键操作配合使用，在按键后执行

### 6. 配置切换步骤

**用途**：切换到其他配置或文本内容

**必需字段**：
- `IsConfigStep`: 必须为 true
- `SwitchConfig` 或 `SwitchTextContent`: 至少一个为 true

**配置示例**：
```json
{
  "Name": "切换到配置2",
  "ImagePath": "",
  "IsEnabled": true,
  "IsConfigStep": true,
  "SwitchConfig": true,
  "TargetConfigName": "配置2",
  "ConfigSwitchWaitMs": 1000,
  "IsJump": false,
  "IsIdleClick": false
}
```


## 完整配置示例

### 示例1：简单的登录流程

```json
{
  "Name": "登录流程",
  "Moles": [
    {
      "Name": "点击登录按钮",
      "ImagePath": "images/login_button.png",
      "IsEnabled": true,
      "CreatedTime": "2025-11-30T10:00:00+08:00",
      "IsIdleClick": false,
      "IdleClickPosition": null,
      "SimilarityThreshold": 0.85,
      "IsJump": false,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": true,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": true,
      "WaitAfterClickMs": 2000,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "IsConfigStep": false,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100
    },
    {
      "Name": "输入用户名",
      "ImagePath": "images/username_field.png",
      "IsEnabled": true,
      "CreatedTime": "2025-11-30T10:01:00+08:00",
      "IsIdleClick": false,
      "IdleClickPosition": null,
      "SimilarityThreshold": 0.85,
      "IsJump": false,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": true,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": true,
      "WaitAfterClickMs": 500,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "IsConfigStep": false,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100
    },
    {
      "Name": "点击确认",
      "ImagePath": "images/confirm_button.png",
      "IsEnabled": true,
      "CreatedTime": "2025-11-30T10:02:00+08:00",
      "IsIdleClick": false,
      "IdleClickPosition": null,
      "SimilarityThreshold": 0.85,
      "IsJump": false,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": true,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": true,
      "WaitAfterClickMs": 3000,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "IsConfigStep": false,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100
    }
  ]
}
```


### 示例2：包含多种步骤类型的复杂流程

```json
{
  "Name": "复杂操作流程",
  "Moles": [
    {
      "Name": "等待主界面加载",
      "ImagePath": "images/main_screen.png",
      "IsEnabled": true,
      "SimilarityThreshold": 0.8,
      "WaitUntilAppear": true,
      "WaitAfterClick": true,
      "WaitAfterClickMs": 1000,
      "IsIdleClick": false,
      "IsJump": false,
      "IsConfigStep": false,
      "ClickUntilDisappear": false,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100,
      "IdleClickPosition": null,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "CreatedTime": "2025-11-30T10:00:00+08:00"
    },
    {
      "Name": "空击某个位置",
      "ImagePath": "",
      "IsEnabled": true,
      "IsIdleClick": true,
      "IdleClickPosition": "500, 300",
      "SimilarityThreshold": 0.85,
      "IsJump": false,
      "IsConfigStep": false,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": false,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": false,
      "WaitAfterClickMs": 1000,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "CreatedTime": "2025-11-30T10:01:00+08:00"
    },
    {
      "Name": "按F2键并向下滚动",
      "ImagePath": "",
      "IsEnabled": true,
      "IsJump": true,
      "SendKeyPress": true,
      "KeyPressDefinition": "F2",
      "KeyPressWaitMs": 2000,
      "EnableMouseScroll": true,
      "ScrollUp": false,
      "ScrollCount": 3,
      "ScrollWaitMs": 1000,
      "IsIdleClick": false,
      "IsConfigStep": false,
      "SimilarityThreshold": 0.85,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": false,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": false,
      "WaitAfterClickMs": 1000,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100,
      "IdleClickPosition": null,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "CreatedTime": "2025-11-30T10:02:00+08:00"
    },
    {
      "Name": "关闭弹窗",
      "ImagePath": "images/close_button.png",
      "IsEnabled": true,
      "ClickUntilDisappear": true,
      "WaitUntilAppear": true,
      "WaitAfterClick": true,
      "WaitAfterClickMs": 2000,
      "SimilarityThreshold": 0.85,
      "IsIdleClick": false,
      "IsJump": false,
      "IsConfigStep": false,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100,
      "IdleClickPosition": null,
      "JumpTargetGroup": "",
      "JumpTargetStep": -1,
      "CreatedTime": "2025-11-30T10:03:00+08:00"
    },
    {
      "Name": "跳转到下一个流程",
      "ImagePath": "",
      "IsEnabled": true,
      "IsJump": true,
      "JumpTargetGroup": "下一流程",
      "JumpTargetStep": -1,
      "IsIdleClick": false,
      "IsConfigStep": false,
      "SimilarityThreshold": 0.85,
      "ClickUntilDisappear": false,
      "WaitUntilAppear": false,
      "JumpToPreviousOnFail": false,
      "StopHunting": false,
      "WaitAfterClick": false,
      "WaitAfterClickMs": 1000,
      "SendKeyPress": false,
      "KeyPressDefinition": "",
      "KeyPressWaitMs": 100,
      "EnableMouseScroll": false,
      "ScrollUp": true,
      "ScrollCount": 1,
      "ScrollWaitMs": 100,
      "SwitchConfig": false,
      "TargetConfigName": "",
      "ConfigSwitchWaitMs": 100,
      "SwitchTextContent": false,
      "TargetTextName": "",
      "TextSwitchWaitMs": 100,
      "IdleClickPosition": null,
      "CreatedTime": "2025-11-30T10:04:00+08:00"
    }
  ]
}
```


## 步骤对象的完整字段列表

**关键要求**：编写配置文件时，每个步骤对象必须包含以下所有字段，不能遗漏任何字段。即使某个字段不使用，也必须设置其默认值。

### 完整字段列表（按推荐顺序）

每个步骤对象必须包含以下 27 个字段：

```json
{
  "Name": "步骤名称",
  "ImagePath": "图片路径或空字符串",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": false,
  "IdleClickPosition": null,
  "SimilarityThreshold": 0.85,
  "IsJump": false,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": false,
  "WaitAfterClickMs": 1000,
  "SendKeyPress": false,
  "KeyPressDefinition": "",
  "KeyPressWaitMs": 100,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
  "TargetConfigName": "",
  "ConfigSwitchWaitMs": 100,
  "SwitchTextContent": false,
  "TargetTextName": "",
  "TextSwitchWaitMs": 100
}
```

### 字段值类型规则

1. **字符串字段**：
   - 不使用或为空时：使用空字符串 `""`（如 `ImagePath`, `JumpTargetGroup`, `KeyPressDefinition`）
   - 例外：`IdleClickPosition` 不使用时应设置为 `null`

2. **布尔字段**：
   - 必须明确设置为 `true` 或 `false`，不能省略

3. **数字字段**：
   - 必须设置具体数值，不能省略
   - `JumpTargetStep` 不使用跳转时设置为 `-1`

4. **时间字段**：
   - `CreatedTime` 使用 ISO 8601 格式：`"YYYY-MM-DDTHH:mm:ss+08:00"`
   - 示例：`"2025-01-27T10:30:00+08:00"`

### 图片路径预留说明

如果编写配置文件时不知道具体的图片文件，可以：
1. **预留标准路径**：使用 `images/` 文件夹下的描述性文件名
   - 示例：`"images/login_button.png"`, `"images/username_field.png"`
2. **运行时替换**：用户可以在运行时通过程序界面选择或替换图片
3. **空字符串**：如果步骤不需要图片（如按键步骤），使用 `""`

## 字段依赖关系

### 步骤类型互斥关系

以下三个字段只能有一个为 true：
- `IsIdleClick`: 空击步骤
- `IsJump`: 跳转步骤
- `IsConfigStep`: 配置切换步骤

如果都为 false，则为默认的图片识别点击步骤。

### 字段组合规则

#### 图片识别点击步骤
- **必需**: `ImagePath` 不为空
- **可选**: `WaitUntilAppear`, `ClickUntilDisappear`, `WaitAfterClick`, `JumpToPreviousOnFail`

#### 空击步骤
- **必需**: `IsIdleClick = true`, `IdleClickPosition` 不为空
- **忽略**: `ImagePath`, `SimilarityThreshold`

#### 跳转步骤
- **必需**: `IsJump = true`
- **可选**: `JumpTargetGroup`, `JumpTargetStep`
- **可选**: `SendKeyPress`, `EnableMouseScroll`（跳转前执行）
- **忽略**: `ImagePath`

#### 按键操作
- **必需**: `SendKeyPress = true`, `KeyPressDefinition` 不为空
- **强烈建议**: `IsJump = true`（即使不进行实际跳转，也建议设置，这是程序处理按键的标准方式）
- **说明**: 当 `IsJump = true` 但不需要跳转时，`JumpTargetGroup` 设为 `""`，`JumpTargetStep` 设为 `-1`

#### 滚动操作
- **必需**: `EnableMouseScroll = true`
- **通常配合**: `SendKeyPress = true` 或 `IsJump = true`

#### 配置切换步骤
- **必需**: `IsConfigStep = true`
- **至少一个**: `SwitchConfig = true` 或 `SwitchTextContent = true`
- **条件**: 如果 `SwitchConfig = true`，需要 `TargetConfigName`
- **条件**: 如果 `SwitchTextContent = true`，需要 `TargetTextName`

## 常见场景配置模板

### 场景1：等待元素出现并点击

```json
{
  "Name": "等待并点击按钮",
  "ImagePath": "images/button.png",
  "IsEnabled": true,
  "WaitUntilAppear": true,
  "WaitAfterClick": true,
  "WaitAfterClickMs": 1000,
  "SimilarityThreshold": 0.85,
  "IsIdleClick": false,
  "IsJump": false,
  "IsConfigStep": false
}
```

### 场景2：持续点击直到元素消失（关闭弹窗）

```json
{
  "Name": "关闭弹窗",
  "ImagePath": "images/close_icon.png",
  "IsEnabled": true,
  "WaitUntilAppear": true,
  "ClickUntilDisappear": true,
  "WaitAfterClick": true,
  "WaitAfterClickMs": 2000,
  "SimilarityThreshold": 0.85,
  "IsIdleClick": false,
  "IsJump": false,
  "IsConfigStep": false
}
```

### 场景3：识别失败时重试上一步

```json
{
  "Name": "验证登录成功",
  "ImagePath": "images/success_icon.png",
  "IsEnabled": true,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": true,
  "SimilarityThreshold": 0.85,
  "IsIdleClick": false,
  "IsJump": false,
  "IsConfigStep": false
}
```

### 场景4：按键 + 滚动组合

```json
{
  "Name": "按F2并向下滚动",
  "ImagePath": "",
  "IsEnabled": true,
  "IsJump": true,
  "SendKeyPress": true,
  "KeyPressDefinition": "F2",
  "KeyPressWaitMs": 2000,
  "EnableMouseScroll": true,
  "ScrollUp": false,
  "ScrollCount": 3,
  "ScrollWaitMs": 1000,
  "IsIdleClick": false,
  "IsConfigStep": false
}
```

### 场景5：流程结束跳转

```json
{
  "Name": "跳转到主流程",
  "ImagePath": "",
  "IsEnabled": true,
  "IsJump": true,
  "JumpTargetGroup": "主流程",
  "JumpTargetStep": -1,
  "IsIdleClick": false,
  "IsConfigStep": false
}
```


## 最佳实践

### 1. 相似度阈值设置

- **0.6-0.7**: 宽松匹配，适用于图片可能有轻微变化的场景
- **0.8-0.85**: 标准匹配，适用于大多数场景（推荐）
- **0.9-0.95**: 严格匹配，适用于需要精确匹配的场景
- **0.95+**: 极严格匹配，可能导致识别失败

### 2. 等待时间设置

- **点击后等待** (`WaitAfterClickMs`):
  - 快速响应: 500-1000ms
  - 普通操作: 1000-2000ms
  - 加载较慢: 3000-5000ms

- **按键后等待** (`KeyPressWaitMs`):
  - 快速响应: 100-500ms
  - 需要处理: 1000-3000ms

- **滚动后等待** (`ScrollWaitMs`):
  - 快速滚动: 100-300ms
  - 等待加载: 500-1000ms

### 3. 步骤命名规范

建议使用清晰的命名，便于理解和调试：
- ✅ "点击登录按钮"
- ✅ "等待主界面加载"
- ✅ "关闭广告弹窗"
- ❌ "步骤1"
- ❌ "mole_001"

### 4. 图片文件组织

建议将图片文件放在 `images` 子文件夹中：
```
分组文件夹/
├── group_config.json
└── images/
    ├── login_button.png
    ├── username_field.png
    └── confirm_button.png
```

配置中使用相对路径：
```json
"ImagePath": "images/login_button.png"
```

### 5. 流程设计建议

- **模块化**: 将复杂流程拆分为多个分组，使用跳转连接
- **容错性**: 关键步骤使用 `WaitUntilAppear` 和 `JumpToPreviousOnFail`
- **可维护性**: 使用清晰的命名和合理的步骤顺序
- **可调试性**: 适当设置等待时间，便于观察执行过程

### 6. 常见错误避免

❌ **错误1**: 忘记设置 `WaitUntilAppear`
```json
{
  "Name": "点击按钮",
  "ImagePath": "images/button.png",
  "WaitUntilAppear": false  // 可能导致按钮未加载就点击
}
```

✅ **正确**:
```json
{
  "Name": "点击按钮",
  "ImagePath": "images/button.png",
  "WaitUntilAppear": true  // 等待按钮出现
}
```

❌ **错误2**: 空击步骤忘记设置坐标
```json
{
  "Name": "空击",
  "IsIdleClick": true,
  "IdleClickPosition": null  // 错误：必须提供坐标
}
```

✅ **正确**:
```json
{
  "Name": "空击",
  "IsIdleClick": true,
  "IdleClickPosition": "500, 300"
}
```

❌ **错误3**: 跳转步骤忘记设置目标
```json
{
  "Name": "跳转",
  "IsJump": true,
  "JumpTargetGroup": ""  // 错误：必须指定目标分组
}
```

✅ **正确**:
```json
{
  "Name": "跳转",
  "IsJump": true,
  "JumpTargetGroup": "主流程"
}
```


## 字段快速参考表

### 必填字段（所有步骤类型）

| 字段 | 类型 | 说明 |
|------|------|------|
| Name | string | 步骤名称 |
| IsEnabled | boolean | 是否启用 |

### 步骤类型标识（三选一或都为false）

| 字段 | 值 | 步骤类型 |
|------|-----|----------|
| IsIdleClick | true | 空击步骤 |
| IsJump | true | 跳转步骤 |
| IsConfigStep | true | 配置切换步骤 |
| 都为 false | - | 图片识别点击步骤 |

### 图片识别步骤专用

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| ImagePath | string | "" | 图片路径（必需） |
| SimilarityThreshold | number | 0.85 | 匹配阈值 |
| WaitUntilAppear | boolean | false | 等待出现 |
| ClickUntilDisappear | boolean | false | 持续点击 |
| JumpToPreviousOnFail | boolean | false | 失败重试 |

### 空击步骤专用

| 字段 | 类型 | 说明 |
|------|------|------|
| IdleClickPosition | string | 坐标 "x, y"（必需） |

### 跳转步骤专用

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| JumpTargetGroup | string | "" | 目标分组名 |
| JumpTargetStep | number | -1 | 目标步骤索引 |

### 按键操作

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| SendKeyPress | boolean | false | 是否按键 |
| KeyPressDefinition | string | "" | 按键定义 |
| KeyPressWaitMs | number | 100 | 按键后等待 |

### 滚动操作

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| EnableMouseScroll | boolean | false | 是否滚动 |
| ScrollUp | boolean | true | 滚动方向 |
| ScrollCount | number | 1 | 滚动次数 |
| ScrollWaitMs | number | 100 | 滚动后等待 |

### 配置切换

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| SwitchConfig | boolean | false | 切换配置 |
| TargetConfigName | string | "" | 目标配置名 |
| SwitchTextContent | boolean | false | 切换文本 |
| TargetTextName | string | "" | 目标文本名 |

## 导入导出说明

### 导出分组

1. 在"显示设置"标签页选中要导出的分组
2. 点击"导出"按钮
3. 分组数据会导出到程序目录的"导出"文件夹
4. 每个分组会创建独立文件夹，包含：
   - `group_config.json`: 配置文件
   - `images/`: 图片文件夹

### 导入分组

1. 点击"导入"按钮
2. 选择包含分组的文件夹（可以是包含多个分组的父文件夹）
3. 程序会自动查找所有 `group_config.json` 文件
4. 如果分组名称冲突，会自动重命名（如 "分组A" → "分组A_2"）
5. 导入成功后自动切换到"打地鼠"界面显示结果

## 编写配置文件的标准流程

### 步骤1：确定流程步骤
根据需求确定需要哪些步骤，每个步骤的类型（图片识别、空击、按键、跳转等）

### 步骤2：为每个步骤填写完整字段
使用以下模板，为每个步骤填写所有 27 个字段：

```json
{
  "Name": "步骤名称（必填，描述性命名）",
  "ImagePath": "图片路径或空字符串",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": false,
  "IdleClickPosition": null,
  "SimilarityThreshold": 0.85,
  "IsJump": false,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": false,
  "WaitAfterClickMs": 1000,
  "SendKeyPress": false,
  "KeyPressDefinition": "",
  "KeyPressWaitMs": 100,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
  "TargetConfigName": "",
  "ConfigSwitchWaitMs": 100,
  "SwitchTextContent": false,
  "TargetTextName": "",
  "TextSwitchWaitMs": 100
}
```

### 步骤3：根据步骤类型调整字段值

#### 图片识别点击步骤
- `ImagePath`: 设置图片路径（如 `"images/button.png"`）
- `WaitUntilAppear`: 通常设为 `true`
- `WaitAfterClick`: 根据是否需要等待设置
- `IsIdleClick`: `false`
- `IsJump`: `false`
- `IsConfigStep`: `false`

#### 按键步骤
- `ImagePath`: `""`
- `SendKeyPress`: `true`
- `KeyPressDefinition`: 设置按键（如 `"F2"`）
- `KeyPressWaitMs`: 建议 1000-3000ms
- `IsJump`: **强烈建议设为 `true`**
- `JumpTargetGroup`: `""`（不跳转时）
- `JumpTargetStep`: `-1`（不跳转时）
- `IsIdleClick`: `false`
- `IsConfigStep`: `false`

#### 空击步骤
- `ImagePath`: `""`
- `IsIdleClick`: `true`
- `IdleClickPosition`: 设置坐标（如 `"1051, 486"`）
- `IsJump`: `false`
- `IsConfigStep`: `false`

#### 跳转步骤
- `ImagePath`: `""`
- `IsJump`: `true`
- `JumpTargetGroup`: 设置目标分组名
- `JumpTargetStep`: 设置目标步骤索引（-1 表示从头开始）
- `IsIdleClick`: `false`
- `IsConfigStep`: `false`

### 步骤4：验证字段完整性
确保每个步骤都包含所有 27 个字段，没有遗漏

### 步骤5：验证 JSON 格式
确保 JSON 格式正确，所有字符串用双引号，注意逗号位置

## 注意事项

1. **字段完整性（最重要）**: 每个步骤必须包含所有 27 个字段，不能遗漏任何字段
2. **图片路径**: 使用相对路径，相对于配置文件所在目录。如果不知道具体图片，可以预留标准路径（如 `"images/login_button.png"`），用户可在运行时替换
3. **坐标格式**: 空击坐标必须是 "x, y" 格式，中间有空格和逗号。不使用时应设置为 `null`
4. **时间单位**: 所有等待时间单位为毫秒（ms）
5. **时间格式**: `CreatedTime` 使用 ISO 8601 格式：`"YYYY-MM-DDTHH:mm:ss+08:00"`
6. **空值处理**: 
   - 字符串字段不使用时应设为空字符串 `""`
   - `IdleClickPosition` 不使用时应设为 `null`
7. **按键步骤**: 强烈建议设置 `IsJump=true`，即使不进行实际跳转
8. **JSON格式**: 确保JSON格式正确，注意逗号和引号
9. **编码格式**: 配置文件使用 UTF-8 编码
10. **字段顺序**: 虽然字段顺序不影响解析，但建议按照标准顺序排列，便于阅读和维护

## 快速参考：完整步骤模板

### 模板1：图片识别点击步骤（完整版）

```json
{
  "Name": "点击登录按钮",
  "ImagePath": "images/login_button.png",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": false,
  "IdleClickPosition": null,
  "SimilarityThreshold": 0.85,
  "IsJump": false,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": true,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": true,
  "WaitAfterClickMs": 2000,
  "SendKeyPress": false,
  "KeyPressDefinition": "",
  "KeyPressWaitMs": 100,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
  "TargetConfigName": "",
  "ConfigSwitchWaitMs": 100,
  "SwitchTextContent": false,
  "TargetTextName": "",
  "TextSwitchWaitMs": 100
}
```

### 模板2：按键步骤（完整版）

```json
{
  "Name": "按F2键自动输入",
  "ImagePath": "",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": false,
  "IdleClickPosition": null,
  "SimilarityThreshold": 0.85,
  "IsJump": true,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": false,
  "WaitAfterClickMs": 1000,
  "SendKeyPress": true,
  "KeyPressDefinition": "F2",
  "KeyPressWaitMs": 2000,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
  "TargetConfigName": "",
  "ConfigSwitchWaitMs": 100,
  "SwitchTextContent": false,
  "TargetTextName": "",
  "TextSwitchWaitMs": 100
}
```

### 模板3：空击步骤（完整版）

```json
{
  "Name": "空击位置",
  "ImagePath": "",
  "IsEnabled": true,
  "CreatedTime": "2025-01-27T00:00:00+08:00",
  "IsIdleClick": true,
  "IdleClickPosition": "1051, 486",
  "SimilarityThreshold": 0.85,
  "IsJump": false,
  "JumpTargetGroup": "",
  "JumpTargetStep": -1,
  "ClickUntilDisappear": false,
  "WaitUntilAppear": false,
  "JumpToPreviousOnFail": false,
  "StopHunting": false,
  "WaitAfterClick": false,
  "WaitAfterClickMs": 1000,
  "SendKeyPress": false,
  "KeyPressDefinition": "",
  "KeyPressWaitMs": 100,
  "EnableMouseScroll": false,
  "ScrollUp": true,
  "ScrollCount": 1,
  "ScrollWaitMs": 100,
  "IsConfigStep": false,
  "SwitchConfig": false,
  "TargetConfigName": "",
  "ConfigSwitchWaitMs": 100,
  "SwitchTextContent": false,
  "TargetTextName": "",
  "TextSwitchWaitMs": 100
}
```

## 版本信息

- 文档版本: 1.1
- 适用程序版本: WindowInspector
- 最后更新: 2025-01-27

---

**提示**: 如果需要更多帮助，可以查看程序导出的示例配置文件，或使用程序界面创建步骤后导出查看生成的配置。
